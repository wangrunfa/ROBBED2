<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<link rel="icon" href="img/favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<title>好多鱼-大数据信息平台</title>
		<script src="js/jquery.min.js"></script>
		<!--<script src="js/addmessage.js"></script>-->
		<link rel="stylesheet" href="css/addmessage.css" />
		<link rel="stylesheet" href="css/website-h5-v1.58.1.min.css">

	</head>
	<body style="background: white">
		<div class="maxbox">
			<div class="jiedaiming"><img src="img/xhdylogo.png" style="width: 27px;float: left"><div class="jiashiann"></div></div>
	       <!--<div class="inputmaxbox">-->
			   <!--<div class="inputminbox theFinalStepInput">-->
				   <!--<div class="Sorting">1</div>-->
				   <!--<div class="prompting"></div>-->
				   <!--<div class="ButtonThe">我要修改</div>-->
			   <!--</div>-->

	       <!--</div>-->
	       <div class="selectmaxbox">


			   <!-- theFinalStep  地一步 -->
			    <div class="theFinalStep" style="height: 660px">
			   				  <!-- Hint of 提示名 -->
			   				    <div class="HintOf">基本信息</div>
			   			 	   <div class="selectItems" style="height: 510px">
								   <p style="padding: 10px 0;">姓名：</p>
			   			 	   <input type="text" class="inputStyle" id="ymjusername" placeholder="您的姓名" />
							  <p style="padding: 10px 0;">手机号码：</p>
							   <input type="text" class="inputStyle" id="ymjphone" placeholder="您的手机号码" />
								   <p style="padding: 10px 0;">身份证号码：</p>
								   <input type="text" class="inputStyle" id="ymjCard" placeholder="您的身份证号码"  style="margin-bottom: 15px"/>

			   			 	   </div>

			   							    <div class="xiayibu theFinalStepSbmit">下一步</div>
			    </div>

			   <!-- payday  发薪日 -->

			   <div class="payday">
				   <!-- Hint of 提示名 -->
				   <div class="HintOf">填写信息</div>
				   <div class="unitsCurrencyselectItems" style="height: 500px;overflow-y:hidden">
					   <div class="isd-form-item isd-form-select-item">

						   <div style="margin: 15px 0;">

								   申请额度

						   </div>

						   <div class="">

							   <div style="background: #f9f9f9;" class="isd-form-picker-paydayMessagess"  onclick="faxinbox()">

								   <span id="paydayMessagess">请选择</span>


							   </div>
						   </div>
					   </div>
					   <div class="isd-form-item isd-form-checkbox-item">

						   <div style="margin: 15px 0;">

								   工作内容

						   </div>

						   <div id="gongzuoneirong" class="isd-form-item-childrenssdsd ">


								   <li class="" value="个体户">
									   个体户
								   </li>

								   <li class="" value="上班族">
									   上班族
								   </li>

								   <li class="" value="公务员">
									   公务员
								   </li>
								   <li class="" value="其他">
									   其他
								   </li>

						   </div>
					   </div>

					   <div class="isd-form-item isd-form-checkbox-item">

						   <div style="margin: 15px 0;">
								   补充条件（多选，提高额度）

						   </div>

						   <div id="bucongtiaojian" class="isd-form-item-childrenssdsd">



								   <li value="有房" class="">
									   有房
								   </li>
								   <li value="有车" class="">
									   有车
								   </li>
								   <li value="有信用卡" class="">
									   有信用卡
								   </li>
								   <li value="有公积金" class="">
									   有公积金
								   </li>
								   <li value="有寿险保单" class="">
									   有寿险保单
								   </li>
								   <li value="有微粒贷" class="">
									   有微粒贷
								   </li>


						   </div>
					   </div>

				   </div>

				   <div class="xiayibu" onclick="submitMessages()">提交</div>
			   </div>
		   </div>
		</div>
		<div class="faxinTimeOneBox">
			<div class="faxinTimeTwoBox" onclick="guanbifaxin()"></div>
			<div class="faxinTimeTwoBox" style="background: white">
				<div class="faxinTimeConter">

					<li value="1万">1万</li>
					<li value="2万">2万</li>
					<li value="3万">3万</li>
					<li value="4万">4万</li>
					<li value="5万">5万</li>
				</div>
			</div>
		</div>
		<!-- 成功-->
		<div class="Confirm-wrapperdasdas">
			<div class="Confirm-wrapper" style="z-index: 100000;display: flex">
				<div class="xj-modal-mask"></div>
				<div class="xj-modal-wrap" style="width: 18rem;">
					<div class="xj-modal-header">
						<div class="xj-modal-title" style="font-size:1rem">提交成功</div><button type="button" class="xj-modal-close"></button>
					</div>
					<div class="xj-modal-body" style="font-size:0.7rem" id="tisihishuadsadsa">申请成功，请您注意接听客服来电！（手机号来电）</div>
					<div class="xj-modal-footer xj-cover-btn"><button style="font-size: .9267rem;height: 2rem;" type="button" class="xj-btn xj-btn-primary xj-ok-btn wanchengss"><span>完成</span></button></div>
				</div>
			</div>

		</div>
		<div class="tankuangshitishi">4546</div>
	</body>

	<script>
		var qdusername = "";
		var qdphone = "";
		var qdcard = "";
		var qdsex = "";
		var qdage = "";
		var qderdu = "";
		var qdgznr = "";
		var qdbctj = "";

		var qsstatus = 0;

		var qsstatusss = 0;

		var pushWorkday = new Array();
		var pushWorkdayss = new Array();
		//身份证正则
		var Cardzz = /^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|31)|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}([0-9]|x|X)$/
		var phonezz = /^1[3456789]\d{9}$/
		var trlstr = /^[1]([3-9])[0-9]{9}$/;

		var ymurlss = "";


		$(".tijiaoshengqing").click(function() {
			if (qsstatus == 1) {
				tishikuang("温馨提示：渠道错误")
				return false;
			}
			qdusername = $("#username").val()
			qdphone = $("#chengePW-phone").val()
			qdage = $("#qdsage").val()
			if (qdusername.length < 1) {
				tishikuang("用户 姓名填写错误")
				return false;
			}
			if (qdsex == "") {
				tishikuang("请选择性别")
				return false;
			}

			if (!(qdage >= 23 && qdage <= 50)) {
				tishikuang("用户 年龄错误 23~50岁之间的用户才能进行额度申请")
				return false;
			}
			if (!trlstr.test(qdphone)) {
				tishikuang("请填写正确的手机号")
				return false;
			}
			if (qderdu == "") {
				tishikuang("请选择额度")
				return false;
			}
			if (qdgznr == "") {
				tishikuang("请选择工作")
				return false;
			}
			qsstatusss = 1;
			sendMessage()
		})

		window.onload = function() {
			findqdtjstatus();
		}

		function findqdtjstatus() {
			var sourceIdsss = getUrlParam('sourceId')
			console.warn(sourceIdsss);
			if (sourceIdsss != null && sourceIdsss != '') {


				$.ajax({
					url: "/findqdtjstatus",
					data: {
						"qdSource": sourceIdsss,
					},
					type: "post",
					dataType: "json",
					success: function(result) {
						console.warn(result)
						if (result.code == 0) {
							qsstatus = 0
						}
						if (result.code == 1) {
							qsstatus = 1
							tishikuang(result.message)
						}
						if (result.code == 2) {
							qsstatus = 1
							tishikuang(result.message)
							$(location).prop('href', 'https://www.mayabox.cn/index.php/index/index/reg/aid/46')
						}
					},
					error: function(result) {
						$(location).prop('href', 'https://www.mayabox.cn/index.php/index/index/reg/aid/46')
						console.warn("error----");
					}
				})
			} else {
				qsstatus = 1
				tishikuang("温馨提示：您没有使用渠道!")
			}


		}


		function submitMessages() {
			if (qsstatus == 1) {
				tishikuang("温馨提示：渠道错误")
				return false;
			}

			if (qderdu == "") {
				tishikuang("温馨提示：请选择额度")
				return false;
			}
			if (qdgznr == "") {
				tishikuang("温馨提示：请选择工作")
				return false;
			}
			$(".jiashiann").fadeIn()
			$.ajax({
				url: "/insertBasicmanagerhdy",
				data: {
					"qdUsername": qdusername,
					"qdPhone": qdphone,
					"qdAge": qdage,
					"qdSex": qdsex,
					"qdLoanpay": qderdu,
					"qdProfessional": qdgznr,
					"qdCard": qdcard,
					"qdAssets": pushWorkday.toString(),
					"lgAuthcode": $("#chengePW-code").val(),
					"qdSource": getUrlParam('sourceId')
				},
				type: "post",
				dataType: "json",
				success: function(result) {
					console.warn(result)
					if (result.code == 0) {
						ymurlss = result.data;
						$(".jiashiann").hide()
						$(".Confirm-wrapperdasdas").fadeIn()
					} else if (result.code == 1) {
						tishikuang(result.message)

					} else if (result.code == 2) {
						$(".tisihishuadsadsa").text("请不要重复提交，谢谢！")
						ymurlss = result.message;
						$(".jiashiann").hide()
						$(".Confirm-wrapperdasdas").fadeIn()
					}

				},
				error: function(result) {
					$(location).prop('href', "/login")
					console.warn("error----");
				}
			})

		}

		function tishikuang(tishizhi) {
			$(".tankuangshitishi").text(tishizhi)
			$(".tankuangshitishi").show().delay(3000).hide(300);
		}
		$("#xuanzhenanlv li").click(function() {
			qdsex = $(this).val()
		})
		$("#gongzuoneirong li").click(function() {
			$("#gongzuoneirong li").removeClass("activesss")
			$(this).addClass("activesss")

			qdgznr = $(this).attr("value")
		})
		$("#xuanzhenanlv li").click(function() {
			$("#xuanzhenanlv li").removeClass("activesss")
			$(this).addClass("activesss")
			qdsex = $(this).attr("value")
		})

		$(".guanbiduanxingyz").click(function() {
			$(".Confirm-wrapperduanxin").fadeOut()
		})
		$(".wanchengss").click(function() {
			if (ymurlss != "") {
				$(location).prop('href', ymurlss)
			}else {
				$(location).prop('href', 'https://www.mayabox.cn/index.php/index/index/reg/aid/46')
			}
		})
		$("#bucongtiaojian li").click(function() {

			if ($(this).attr("class") == "") {
				$(this).addClass("activesss")
			} else {
				$(this).removeClass("activesss")
			}
			$('#bucongtiaojian .activesss').each(function(key, value) {
				pushWorkday[key] = $(this).attr("value"); //如果是其他标签 用 html();
				pushWorkdayss[key] = $(this).html(); //如果是其他标签 用 html();
				// 或btn[key] = $(value).val();
			});
		})
		$(".faxinTimeConter li").click(function() {
			var ss = $(this).attr("value")
			$("#paydayMessagess").text(ss)
			qderdu = ss
			$(".faxinTimeOneBox").fadeOut()
		})

		function guanbifaxin() {
			$(".faxinTimeOneBox").fadeOut()
		}

		function faxinbox() {

			$(".faxinTimeOneBox").fadeIn()
		}



			// var storage = window.localStorage;
			//theFinalStep  最后一步

			$(".theFinalStepSbmit").click(function () {
				if (qsstatus!=0){
					tishikuang("温馨提示：渠道错误");
					return false
				}
				qdusername = $("#ymjusername").val();
				if (qdusername.length<2){
					tishikuang("温馨提示：请您填写姓名！")
					return false
				}


					qdphone = $("#ymjphone").val();
					if (!phonezz.test(qdphone)) {
						tishikuang("温馨提示：请正确填写手机号")
						return false
					}
						qdcard = $("#ymjCard").val();
				if (qdcard.length<10) {
					tishikuang("温馨提示：请正确填写身份证号")
					return false
				}
				// if (Cardzz.test(ymjCard)) {
						var sourceIdsss= getUrlParam('sourceId')
						$(".jiashiann").fadeIn()

						$.ajax({
							url: "/judgeUserMessage",
							data: {
								"name": qdusername,
								"mobile": qdphone,
								"idcard": qdcard,
								"sourceId":sourceIdsss
							},
							type: "post",
							dataType: "json",
							success: function (resultJson) {
								console.warn(resultJson)
								if (resultJson.code==1){
									tishikuang(resultJson.message);
								}
								if (resultJson.code == 0) {
									if (resultJson.result.res == 1) {
										qdsex = resultJson.result.sex;

										var ymjagebirthday = resultJson.result.birthday;
										var returnAge = agesss(ymjagebirthday.slice(0, 4) + "-" + ymjagebirthday.slice(4, 6) + "-" + ymjagebirthday.slice(6, 8));


										if (returnAge >= 23 && returnAge <= 50) {
											qdage = returnAge;

											$(".theFinalStep").fadeOut();

											$(".jiashiann").hide()
										} else {
											if (resultJson.requsetNumber==3){
												tishikuang("温馨提示：实名错误提示，实名需要三要素一致， 姓名，手机号码，身份证 ")
											}else{
												tishikuang("温馨提示：您的年龄不符合申请要求-年龄条件：23-50 之间")
											}

										}

									} else {
										// alert("错误！请检查-姓名,手机号,身份证-是否都为 您 所有")
										if (resultJson.requsetNumber==3){
											tishikuang("温馨提示：实名错误提示，实名需要三要素一致， 姓名，手机号码，身份证 ")
										}else {
											tishikuang("温馨提示：请检查您的实名信息是否填写正确！")
										}
									}


								}

								$(".jiashiann").hide()
							},
							error: function (result) {
								$(".jiashiann").hide()
								// $(location).prop('href', "/login")
								tishikuang("温馨提示：您的信息填写错误，请重试！")
							}
						})
						$(".theFinalStepInput>.prompting").html("姓名:" + ymjusername);


			})
		function getUrlParam(name) { //封装方法
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
			var r = window.location.search.substr(1).match(reg); //匹配目标参数
			if (r != null) return unescape(r[2]);
			return null; //返回参数值
		}
		function agesss(str) {
			var r = str.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);
			if (r == null) return 0;
			var d = new Date(r[1], r[3] - 1, r[4]);
			if (d.getFullYear() == r[1] && (d.getMonth() + 1) == r[3] && d.getDate() == r[4]) {
				var Y = new Date().getFullYear();
				return Y - r[1]
			}
			return ("输入的日期格式错误！");
		}
	</script>
	<style>
		.isd-form-item-childrenssdsd li{
			margin: 5px 8px;
			display: inline-block;
			padding: 7px 12px;
			list-style: none;
			border-radius: 6px;
			border: 1px solid #dcdee3;


		}

		.Confirm-wrapperduanxin {
			display: none;
		}

		.Confirm-wrapperdasdas {
			display: none;
		}
.isd-form-picker-paydayMessagess{
	height: 58px;
	line-height: 58px;
	background: #f9f9f9;
	text-indent: 15px;
	color: #999;
	border-radius: 8px;
}
		.tankuangshitishi {
			display: none;
			background: rgb(46, 152, 239);;
			color: white;
			height: 40px;
			width: 100%;
			line-height: 40px;
			text-indent: 10px;
			position: fixed;
			top: 0;
			z-index: 1200;
			left: 0;
		}

		.duanxinahshjdsa {
			font-size: 14px;
			margin-bottom: 35px;
		}

		.activesss {
			background: rgb(46, 152, 239) !important;
			color: white;
		}

		.faxinTimeOneBox {
			display: none;
			background-color: rgba(0, 0, 0, 0.4);
			position: fixed;
			z-index: 10000;
			bottom: 0;
			right: 0;
			left: 0;
			top: 0;
		}

		.faxinTimeTwoBox {
			width: 100%;
			height: 50%;
			float: left;

		}

		.faxinTimeConter {
			padding-top: 30px;
			overflow-y: scroll;
			max-width: 400px;
			height: 100%;
			margin: 0 auto;
			position: relative;
		}

		.faxinTimeConter>li {
			list-style: none;
			width: 100%;
			height: 32px;
			float: left;
			text-align: center;
			line-height: 32px;
			font-weight: bold;
			color: #333333;
			margin: 10px auto;
			position: relative;
		}

		.faxinTimeConter>li:hover {
			background: rgb(46, 152, 239);;
			color: white;
			cursor: pointer;
		}

		.faxinfeixuanzhecontent {
			background-color: rgb(255, 255, 255);
			position: absolute;
			bottom: 0;
			height: 50%;
			width: 100%;
		}

		.register-phone-yanzm {
			background: rgba(0, 0, 0, 0);
			border: 0;
			height: 35px;
			color: #999;
			color: #007AFF;
		}

		#chengePW-code {
			height: 35px;
			border: 0;

			background: rgba(0, 0, 0, 0);
		}

		.chengePW-codessssssss {
			border-bottom: 1px solid #999;
		}
	</style>
</html>
