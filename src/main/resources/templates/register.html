<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link rel="icon" href="img/bitbug_favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
    <title>云借条-大数据信息平台</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Custom Font Icons CSS-->
    <link rel="stylesheet" href="css/font.css">
    <!-- Google fonts - Muli-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>
  <body>
  <style>

      /*验证码*/

      .upload-awrp {
          overflow: hidden;
          margin: 120px 0;
      }

      .code {
          font-family: Arial;
          font-style: italic;
          font-size: 30px;
          border: 0;
          padding: 2px 3px;
          letter-spacing: 3px;
          font-weight: bolder;
          float: left;
          cursor: pointer;
          width: 150px;
          height: 60px;
          line-height: 60px;
          text-align: center;
          vertical-align: middle;
          border: 1px solid #6D6D72;
      }

  </style>
    <div class="login-page">
      <div class="container d-flex align-items-center">
        <div class="form-holder has-shadow">
          <div class="row">
            <!-- Logo & Information Panel-->
            <div class="col-lg-6">
                <div class="info d-flex align-items-center">
                    <div class="content">
                        <div class="logo">
                            <img style="width: 100%" src="img/yjtlogo.png">
                        </div>

                    </div>
                </div>
            </div>
            <!-- Form Panel    -->
            <div class="col-lg-6 bg-white">
              <div class="form d-flex align-items-center">
                <div class="content">
                  <form class="text-left form-validate">
                      <div class="form-group-material">
                          <input id="register-username" type="text" name="username" minlength="2" required data-msg="请输入用户名" class="input-material">
                          <label for="register-username" class="label-material">用户名</label>
                      </div>

                      <div class="form-group-material" style="height: 30px">
                          <input type="radio" value="0" name="sex" class="input-radios" style="background: cornflowerblue">
                          <div style="width: 30px;height: 25px;float: left">男</div>
                          <input type="radio" value="1" name="sex"  class="input-radios" style="background: #ed4ac5">
                          <div style="width: 30px;height: 25px;float: left">女</div>
                      </div>
                      <div class="form-group-material">
                          <input id="register-phone" type="text" name="phone" minlength="11"  required data-msg="请输入手机号" class="input-material">
                          <label for="register-phone" class="label-material">手机号</label>
                      </div>
                    <div class="form-group-material">
                      <input id="register-password" type="password" name="password" minlength="6"  required data-msg="请输入密码" class="input-material">
                      <label for="register-password" class="label-material">密码</label>
                    </div>



                    <div class="form-group-material" >
                      <input id="register-code"style="width: 70%" type="text" minlength="4"  name="authcode" required data-msg="请输入验证码" class="input-material">
                      <label for="register-code"style="width: 70%" class="label-material" required >手机号验证</label>

                      <input class="register-phone-yanzm"  id="btnSendCode" name="btnSendCode" type="button"   value="获取验证码" onclick="sendMessage();" />

                    </div>

<!--                    <div class="form-group terms-conditions text-center">-->
<!--                      <input id="register-agree" name="registerAgree" type="checkbox" required value="1" data-msg="Your agreement is required" class="checkbox-template">-->
<!--                      <label for="register-agree">我同意条款</label>-->
<!--                    </div>-->

  <script>
function registerjq() {

    $.ajax({
        //请求方式
        type : "post",
        //请求的媒体类型
        // contentType: "application/json;charset=UTF-8",
        //请求地址
        url : "/register",
        //数据，json字符串
        // data : {"username":$("#register-username").val(),"studentNumber":$("#register-studentNumber").val(),
        //     "password":$("#register-password").val(),"sex":$('input[name="sex"]:checked').val(),"phone":$("#register-phone").val,"authcode":$("#register-code").val()},
        data:{"lgPassword":$("#register-password").val(),
            "lgPhone":$("#register-phone").val(),
            "lgAuthcode":$("#register-code").val(),
            "lgSex":$('input[name="sex"]:checked').val(),
            "lgUsername":$("#register-username").val(),
        },
        //请求成功
        success : function(result) {
            console.log(result)
            if(result.code==0){
                $(location).prop('href', '/login')
            }
            if(result.code==1){
                alert(result.message)
            }

        },
        //请求失败，包含具体的错误信息
        error : function(e){
            console.log(e.status);
            console.log(e.responseText);
        }
    });
}

  var InterValObj; //timer变量，控制时间
  var count = 60; //间隔函数，1秒执行
  var curCount;//当前剩余秒数
  //发送短信验证码
  function sendMessage() {
    var trlstr=/^[1]([3-9])[0-9]{9}$/;
    var phones=document.getElementById("register-phone").value;
    console.log(trlstr.test(phones))
    if(!trlstr.test(phones)){
      document.getElementById("btnSendCode").value="请检查手机号";
      return false;
    }
      $.ajax({
          //请求方式
          type : "POST",
          //请求的媒体类型
         // contentType: "application/json;charset=UTF-8",
          //请求地址
          url : "/authcode",
          //数据，json字符串
          data : {"phone":phones},
          //请求成功
          success : function(result) {
              console.log(result)

              if(result.code==0){
              curCount = count;
              // 设置button效果，开始计时
              document.getElementById("btnSendCode").setAttribute("disabled","true" );//设置按钮为禁用状态
              document.getElementById("btnSendCode").value=curCount + "秒后重获";//更改按钮文字
              InterValObj = window.setInterval(SetRemainTime, 1000); // 启动计时器timer处理函数，1秒执行一次
              }else{
                  alert("操作频繁，请稍候再试")
              }
          },
          //请求失败，包含具体的错误信息
          error : function(e){
              console.log(e.status);
              console.log(e.responseText);
          }
      });


  }

  //timer处理函数
  function SetRemainTime() {
    if (curCount == 0) {//超时重新获取验证码
      window.clearInterval(InterValObj);// 停止计时器
      document.getElementById("btnSendCode").removeAttribute("disabled");//移除禁用状态改为可用
      document.getElementById("btnSendCode").value="重获验证码";
    }else {
      curCount--;
      document.getElementById("btnSendCode").value=curCount + "秒后重获";
    }
  }
</script>
                      <script type="text/javascript">
                          /**
                           * 验证码
                           * @param {Object} o 验证码长度
                           */
                          $.fn.code_Obj = function(o) {
                              var _this = $(this);
                              var options = {
                                  code_l: o.codeLength,//验证码长度
                                  codeChars: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                                      'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
                                      'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'
                                  ],
                                  codeColors: ['#f44336', '#009688', '#cddc39', '#03a9f4', '#9c27b0', '#5e4444', '#9ebf9f', '#ffc8c4', '#2b4754', '#b4ced9', '#835f53', '#aa677e'],
                                  code_Init: function() {
                                      var code = "";
                                      var codeColor = "";
                                      var checkCode = _this.find("#data_code");
                                      for(var i = 0; i < this.code_l; i++) {
                                          var charNum = Math.floor(Math.random() * 52);
                                          code += this.codeChars[charNum];
                                      }
                                      for(var i = 0; i < this.codeColors.length; i++) {
                                          var charNum = Math.floor(Math.random() * 12);
                                          codeColor = this.codeColors[charNum];
                                      }
                                      console.log(code);
                                      if(checkCode) {
                                          checkCode.css('color', codeColor);
                                          checkCode.className = "code";
                                          checkCode.text(code);
                                          checkCode.attr('data-value', code);
                                      }
                                  }
                              };

                              options.code_Init();//初始化验证码
                              _this.find("#data_code").bind('click', function() {
                                  options.code_Init();
                              });
                          };
                      </script>
                      <script type="text/javascript">
                          /**
                           * 验证码
                           * codeLength:验证码长度
                           */
                          $('#check-code').code_Obj({
                              codeLength: 5
                          });
                      </script>
                    <div class="form-group text-center">
                      <input id="register" type="button" value="注册账户" onclick="registerjq();" class="btn btn-primary">
                    </div>
                  </form><small>已经有账户了?</small><a href="/loginym" class="signup">点击登录</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div class="copyrights text-center">
            <p>云借条<a href="/login" class="external">qd.mayabox.cn</a></p>
        </div>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="js/front.js"></script>
  </body>
</html>